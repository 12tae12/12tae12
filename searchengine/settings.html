<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" crossorigin="anonymous">
    <style>
        body {
            font-family: 'Source Sans 3', 'Segoe UI', 'Arial', sans-serif;
            background: #000;
            color: #e6f5e1;
        }
        .settings-container {
            background: #1a2b1a;
            border-radius: 1.5em;
            box-shadow: 0 4px 32px #000;
            max-width: 420px;
            margin: 7vh auto;
            padding: 2em 2em 1.5em 2em;
        }
        h2 {
            color: #7fffa7;
            margin-bottom: 1.5em;
        }
        .form-check-label {
            font-size: 1.1em;
        }
        .btn-back {
            background: #232d23;
            color: #7fffa7;
            border: 1px solid #2e4d2e;
            margin-bottom: 1.5em;
        }
        .btn-back:hover {
            background: #2e4d2e;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <button class="btn btn-back" onclick="window.history.back()" title="Back">&larr; Back</button>
        <h2>Settings</h2>
        <div class="form-check form-switch mb-4">
            <input class="form-check-input" type="checkbox" id="safeSearchSwitch">
            <label class="form-check-label" for="safeSearchSwitch">Safe Search</label>
        </div>
        <div class="form-check form-switch mb-4">
            <input class="form-check-input" type="checkbox" id="autocorrectSwitch">
            <label class="form-check-label" for="autocorrectSwitch">Autocorrect & Suggestions</label>
        </div>
        <div class="form-check form-switch mb-4">
            <input class="form-check-input" type="checkbox" id="aiSpellCheckSwitch">
            <label class="form-check-label" for="aiSpellCheckSwitch">AI Spell Checker (Experimental)</label>
        </div>
        <!-- Add more settings options here -->
    </div>
    <script src="https://js.puter.com/v2/"></script>
    <script>
        // Load Safe Search state from localStorage
        const safeSearchSwitch = document.getElementById('safeSearchSwitch');
        let safeSearchOn = localStorage.getItem('safeSearch') !== 'false';
        safeSearchSwitch.checked = safeSearchOn;
        safeSearchSwitch.addEventListener('change', function() {
            localStorage.setItem('safeSearch', safeSearchSwitch.checked);
        });

        // Load Autocorrect state from localStorage
        const autocorrectSwitch = document.getElementById('autocorrectSwitch');
        let autocorrectOn = localStorage.getItem('autocorrect') === 'true';
        autocorrectSwitch.checked = autocorrectOn;
        autocorrectSwitch.addEventListener('change', function() {
            localStorage.setItem('autocorrect', autocorrectSwitch.checked);
        });

        // Load AI Spell Checker state from localStorage
        const aiSpellCheckSwitch = document.getElementById('aiSpellCheckSwitch');
        // Always read from localStorage, not from a variable
        aiSpellCheckSwitch.checked = localStorage.getItem('aiSpellCheck') === 'true';
        aiSpellCheckSwitch.addEventListener('change', async function() {
            if (aiSpellCheckSwitch.checked) {
                // Experiment: test if puter.ai is available for spell check
                try {
                    if (window.puter && puter.ai) {
                        await puter.ai.chat('Spell check: test');
                        localStorage.setItem('aiSpellCheck', 'true');
                        aiSpellCheckSwitch.checked = true;
                    } else {
                        throw new Error('Puter.ai not available');
                    }
                } catch {
                    aiSpellCheckSwitch.checked = false;
                    localStorage.setItem('aiSpellCheck', 'false');
                    alert('AI Spell Checker could not be enabled (Puter.ai unavailable).');
                }
            } else {
                localStorage.setItem('aiSpellCheck', 'false');
                aiSpellCheckSwitch.checked = false;
            }
        });
    </script>
</body>
</html>
